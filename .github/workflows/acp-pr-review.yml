name: PR Review

on:
  pull_request:
    types: [opened, synchronize, reopened]

permissions:
  contents: read
  pull-requests: write

jobs:
  review:
    name: AI PR Review
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v6

      - name: Set up Python
        uses: actions/setup-python@v6
        with:
          python-version: "3.12"

      - name: Install agentform-cli
        run: pip install agentform-cli==0.0.3

      - name: Run PR Review
        working-directory: .agentform
        run: |
          agentform run review_pr \
            --var openai_api_key=${{ secrets.OPENAI_API_KEY }} \
            --var github_personal_access_token=${{ secrets.GITHUB_TOKEN }} \
            --var owner=${{ github.repository_owner }} \
            --var repo=${{ github.event.repository.name }} \
            --var pr_number=${{ github.event.pull_request.number }}